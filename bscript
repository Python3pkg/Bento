import os
import sys
import subprocess

from bento.commands.errors \
    import \
        CommandExecutionFailure
from bento.commands.core \
    import \
        Command
from bento.core.utils \
    import \
        pprint

class TestCommand(Command):
    def run(self, opts):
        pprint('BLUE', "Running test command....")
        saved = os.getcwd()

        cmd = ["nosetests", "-s", "-v", "bento"]
        p = subprocess.Popen(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        stdout, stderr = p.communicate()
        if p.returncode != 0:
            print stderr
            return p.returncode
        else:
            print stderr

def startup(context):
    context.register_command("test", TestCommand)
