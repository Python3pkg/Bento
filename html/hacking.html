<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Design notes &mdash; Bento 0.2.0-git2be31f57c3 documentation</title>
    
    <link rel="stylesheet" href="static/nature.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2.0-git2be31f57c3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Bento 0.2.0-git2be31f57c3 documentation" href="index.html" />
    <link rel="next" title="FAQ" href="faq.html" />
    <link rel="prev" title="How to contribute" href="contribute.html" />
 
<style type="text/css">
  table.right { float: right; margin-left: 20px; }
  table.right td { border: 1px solid #ccc; }
</style>

  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="faq.html" title="FAQ"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="contribute.html" title="How to contribute"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Bento home</a>&nbsp;|&nbsp;</li>
        <li><a href="contents.html">Documentation</a>
          &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="design-notes">
<h1>Design notes<a class="headerlink" href="#design-notes" title="Permalink to this headline">¶</a></h1>
<p>This is not really readable at the moment, mostly some personal notes about
current internal design.</p>
<p>Bento is currently split into two parts: a core API to parse the
package description into a simple object API, and a commands library
which gives a command line interface to bento.</p>
<p>The main design philosophy of bento is to clearly separate the
different stages of packaging deployment, as we believe it is the only
way to make a build tool extensible.</p>
<div class="section" id="commands-protocol">
<h2>Commands &#8220;protocol&#8221;<a class="headerlink" href="#commands-protocol" title="Permalink to this headline">¶</a></h2>
<p>The command line interface of bento currently supports 3 stages:</p>
<blockquote>
<div><ul class="simple">
<li>configuration: is concerned with configuring user options
(build/install customization).</li>
<li>build: compile C extensions</li>
<li>install: deploy the software into the system as configured
at the first stage. Installers are considered installation
as well for reasons explained later.</li>
</ul>
</div></blockquote>
<p>Although those stages are very similar to distutils/setuptools
mechanism, the implementation is fundamentally different, because each
stage is mostly independent from each other. No python object is
directly shared between commands - the current bentomaker
implementation implements each stage as a separate run. Once
configured, every command has access to all options.</p>
</div>
<div class="section" id="build-manifest-and-building-installers">
<h2>Build manifest and building installers<a class="headerlink" href="#build-manifest-and-building-installers" title="Permalink to this headline">¶</a></h2>
<p>Bento uses a slightly unusal process to install the bits of your package.
Instead of copying directly the files to the desired location, the install
process is driven by a build manifest. This build manifest is produced by the
build command. It contains a description of files per category as well as a few
metadata. The syntax is based of JSON so that it can easily be parsed from any
language and in most environments (local machine, browser, etc...).</p>
<div class="section" id="format-internals">
<h3>Format internals<a class="headerlink" href="#format-internals" title="Permalink to this headline">¶</a></h3>
<p>(This is likely to change in the future)</p>
<p>The json file contains 4 elements:</p>
<blockquote>
<div><ul class="simple">
<li>meta: this contains the metadata (as defined in the relevant
packaging PEP)</li>
<li>install_paths: a dict of the configured paths</li>
<li>file_sections: a list of so-called file sections</li>
<li>executables: a list of executable sections</li>
</ul>
</div></blockquote>
<div class="section" id="file-sections">
<h4>File sections<a class="headerlink" href="#file-sections" title="Permalink to this headline">¶</a></h4>
<p>A list of dictionaries. Each dictionary contains:</p>
<blockquote>
<div><ul class="simple">
<li>category: the category name</li>
<li>name: name of this section</li>
<li>files: a list of tuple source -&gt; target</li>
<li>source_dir: os.path.join(source_dir, source) gives an absolute path
for each source file</li>
<li>target_dir: os.path.join(target_dir, target) gives an absolute path
for each target file</li>
</ul>
</div></blockquote>
<p>Note that both source_dir and target_dir can refer to path variables as defined
in the install_paths section. This allows to &#8220;retarget&#8221; a build tree to
different tree configurations, as required by different packages formats.</p>
<p>Example:</p>
<div class="highlight-python"><pre>"category": "executables",
     "files": [
         [
             "bentomaker-2.7",
             "bentomaker"
         ]
     ],
     "name": "bentomaker",
     "source_dir": "$_srcrootdir/scripts-2.7",
     "target_dir": "$bindir"</pre>
</div>
<p>This is interpreted as installing the file
$_srcrootdir/scripts-2.7/bentomaker-2.7 into $bindir/bentomaker.</p>
</div>
</div>
<div class="section" id="advantages">
<h3>Advantages<a class="headerlink" href="#advantages" title="Permalink to this headline">¶</a></h3>
<p>The built bits and the build manifest are enough to install the
software to arbitrary location, so that the install process does not
need to know anything about the build process.  Conversely, as long as
you can produce a build manifest, you can use the installation
commands as is.</p>
<p>Besides installation, the manifest is also used to produce installers.
Currently, windows installers (both .exe and .msi), eggs and mpkg are
supported, and adding new types of installers should be easier than with
distutils. If you look at the build_wininst and build_egg commands source code,
they are simple, and most of the &#8220;magic&#8221; happens in the build manifest. In
particular, the build manifest still refers to installed bits relatively to
abstract paths, and those paths are resolved when building the installers.</p>
</div>
<div class="section" id="installers-conversion">
<h3>Installers conversion<a class="headerlink" href="#installers-conversion" title="Permalink to this headline">¶</a></h3>
<p>The build manifest is intended to be included in each produced
installer, for convertion between various formats. The goal is to have
idempotent conversions (e.g.  converting an egg to wininst and then
converting it back to an egg produces the exact same egg).</p>
<p>We also intend to use build manifest for the upcoming &#8216;&#8217;nest&#8217;&#8217;
service, which will contain a database of installed software.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Design notes</a><ul>
<li><a class="reference internal" href="#commands-protocol">Commands &#8220;protocol&#8221;</a></li>
<li><a class="reference internal" href="#build-manifest-and-building-installers">Build manifest and building installers</a><ul>
<li><a class="reference internal" href="#format-internals">Format internals</a><ul>
<li><a class="reference internal" href="#file-sections">File sections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advantages">Advantages</a></li>
<li><a class="reference internal" href="#installers-conversion">Installers conversion</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="contribute.html"
                        title="previous chapter">How to contribute</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="faq.html"
                        title="next chapter">FAQ</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/hacking.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="faq.html" title="FAQ"
             >next</a> |</li>
        <li class="right" >
          <a href="contribute.html" title="How to contribute"
             >previous</a> |</li>
        <li><a href="index.html">Bento home</a>&nbsp;|&nbsp;</li>
        <li><a href="contents.html">Documentation</a>
          &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2011, David Cournapeau.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>