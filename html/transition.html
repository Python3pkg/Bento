

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Transition from existing python packaging infrastructure &mdash; Bento vdev-nobuilt-gitdev-nobuil documentation</title>
    <link rel="stylesheet" href="static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     'dev-nobuilt-gitdev-nobuil',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="top" title="Bento vdev-nobuilt-gitdev-nobuil documentation" href="index.html" />
    <link rel="next" title="How to contribute" href="contribute.html" />
    <link rel="prev" title="Single-file distribution" href="singlefile.html" />
 
<style type="text/css">
  table.right { float: right; margin-left: 20px; }
  table.right td { border: 1px solid #ccc; }
</style>

  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="contribute.html" title="How to contribute"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="singlefile.html" title="Single-file distribution"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Bento home</a>&nbsp;|&nbsp;</li>
        <li><a href="contents.html">Documentation</a>
          &raquo;</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Transition from existing python packaging infrastructure</a><ul>
<li><a class="reference internal" href="#converting-distutils-based-packages">Converting distutils-based packages</a></li>
<li><a class="reference internal" href="#adding-bento-based-setup-py-for-compatibility-with-pip-etc">Adding bento-based setup.py for compatibility with pip, etc...</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="singlefile.html"
                        title="previous chapter">Single-file distribution</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="contribute.html"
                        title="next chapter">How to contribute</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/transition.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="transition-from-existing-python-packaging-infrastructure">
<h1>Transition from existing python packaging infrastructure<a class="headerlink" href="#transition-from-existing-python-packaging-infrastructure" title="Permalink to this headline">¶</a></h1>
<p>Even if you are convinced than bento is more appropriate for your needs than
current distutils-based tools, there is a significant hurdle to transition to a
new infrastructure for your package. First, you need to convert your package,
but you also potentially loose goodies such a putting your package on pypi, or
being installable through tools such as pip or easy_install.</p>
<p>Ideally, such tools would become pluggable so that they can be made aware of
new packaging formats, but in the mean-time, the practical approach of bento is
to &#8220;emulate&#8221; distutils just enough to make them work with the most useful bits
of the current python packaging infrastructure, and to provide tools to convert
existing setup.py to the bento format.</p>
<div class="section" id="converting-distutils-based-packages">
<h2>Converting distutils-based packages<a class="headerlink" href="#converting-distutils-based-packages" title="Permalink to this headline">¶</a></h2>
<p>The bentomaker command-line tool has a convert command which should be run at
the top of your source tree (the directory containing your top setup.py).
Because the convert command works by running the setup.py, you need to make
sure you can run the setup.py. To convert your package, just do:</p>
<div class="highlight-python"><pre>bentomaker convert</pre>
</div>
<p>If successfull, this will write a bento.info file whose content has been pulled
of the convert command analysis (it will not overwrite an existing one). It
first tries to determine whether your setup.py uses setuptools or not, and then
run it with mocked distutils objects for the actual conversion.  Since the
convert command works by inserting various hooks into distutils internals, it
is inherently fragile.</p>
<p>It will definitely not work in the following cases:</p>
<blockquote>
<div><ul class="simple">
<li>you use the package_dir feature: bento does not support the feature at all.</li>
<li>you have your own distutils extensions (setuptools and numpy.distutils
are somehow handled, though, and other common distutils extensions may be
added as well).</li>
</ul>
</div></blockquote>
<p>It should support the following features:</p>
<blockquote>
<div><ul class="simple">
<li>All the distutils metadata</li>
<li>Some setuptools metadata (like require or console scripts)</li>
<li>module, packages and extensions</li>
<li>data files as specified in data_files</li>
<li>source files in MANIFEST[.in]</li>
</ul>
</div></blockquote>
<p>Note:: because the convert command does not parse the setup.py, but runs it
instead, it only handles package description as defined by this one run of
setup.py. For example, bento convert cannot automatically handle the following
setup.py:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;win32&quot;</span><span class="p">:</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;sphinx&quot;</span><span class="p">,</span> <span class="s">&quot;pywin32&quot;</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">requires</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;sphinx&quot;</span><span class="p">]</span>

<span class="n">setup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="n">install_requires</span><span class="o">=</span><span class="n">requires</span><span class="p">)</span>
</pre></div>
</div>
<p>If run on windows, the generated bento.info will be:</p>
<div class="highlight-python"><pre>Name: foo

Library:
    InstallRequires:
        pywin32,
        sphinx</pre>
</div>
<p>and:</p>
<div class="highlight-python"><pre>Name: foo

Library:
    InstallRequires:
        sphinx</pre>
</div>
<p>otherwise.</p>
<p>Note:: bento syntax supports simple conditional, so after conversion, you
could modify the generated file as follows:</p>
<div class="highlight-python"><pre>Name: foo

Library:
    InstallRequires:
        sphinx
    if os(win32):
        InstallRequires:
            pywin32</pre>
</div>
</div>
<div class="section" id="adding-bento-based-setup-py-for-compatibility-with-pip-etc">
<h2>Adding bento-based setup.py for compatibility with pip, etc...<a class="headerlink" href="#adding-bento-based-setup-py-for-compatibility-with-pip-etc" title="Permalink to this headline">¶</a></h2>
<p>Although nothing fundamentally prevents bento to work under installers such as
pip, pip currently does not know anything about bento. To help transition,
bento has a distutils compatibility layer. A setup.py as simple as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">setuptools</span>
<span class="kn">import</span> <span class="nn">bento.distutils</span>

<span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">setup</span><span class="p">()</span>
</pre></div>
</div>
<p>will enable commands such as:</p>
<div class="highlight-python"><pre>python setup.py install
python setup.py sdist</pre>
</div>
<p>to work as expected, taking all the package information from bento.info file.</p>
<p>Note:: obviously, this mode will not enable all the features offered by bento.
If it were possible, bento would not have been written in the first place.
Nevertheless, the following commands should work relatively well as long as you
don&#8217;t have hooks:</p>
<blockquote>
<div><ul class="simple">
<li>sdist</li>
<li>bdist_egg</li>
<li>install</li>
</ul>
</div></blockquote>
<p>This should be enough for pip install foo or easy_install foo to work for a
bento-based package.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="contribute.html" title="How to contribute"
             >next</a> |</li>
        <li class="right" >
          <a href="singlefile.html" title="Single-file distribution"
             >previous</a> |</li>
        <li><a href="index.html">Bento home</a>&nbsp;|&nbsp;</li>
        <li><a href="contents.html">Documentation</a>
          &raquo;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2009-2011, David Cournapeau.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>